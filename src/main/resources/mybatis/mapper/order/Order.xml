<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.taobao.mapper.order.OrderMapper">


    <resultMap id="BaseResultMap" type="cn.taobao.entity.order.OrderInfo">
        <id column="Id" jdbcType="INTEGER" property="id" />
        <result column="adzone_id" jdbcType="VARCHAR" property="adzoneId" />
        <result column="adzone_name" jdbcType="VARCHAR" property="adzoneName" />
        <result column="alimama_rate" jdbcType="VARCHAR" property="alimamaRate" />
        <result column="alimama_share_fee" jdbcType="VARCHAR" property="alimamaShareFee" />
        <result column="alipay_total_price" jdbcType="VARCHAR" property="alipayTotalPrice" />
        <result column="click_time" jdbcType="VARCHAR" property="clickTime" />
        <result column="deposit_price" jdbcType="VARCHAR" property="depositPrice" />
        <result column="flow_source" jdbcType="VARCHAR" property="flowSource" />
        <result column="income_rate" jdbcType="VARCHAR" property="incomeRate" />
        <result column="item_category_name" jdbcType="VARCHAR" property="itemCategoryName" />
        <result column="item_id" jdbcType="VARCHAR" property="itemId" />
        <result column="item_img" jdbcType="VARCHAR" property="itemImg" />
        <result column="item_link" jdbcType="VARCHAR" property="itemLink" />
        <result column="item_num" jdbcType="VARCHAR" property="itemNum" />
        <result column="item_price" jdbcType="VARCHAR" property="itemPrice" />
        <result column="item_title" jdbcType="VARCHAR" property="itemTitle" />
        <result column="order_type" jdbcType="VARCHAR" property="orderType" />
        <result column="pub_id" jdbcType="VARCHAR" property="pubId" />
        <result column="pub_share_fee" jdbcType="VARCHAR" property="pubShareFee" />
        <result column="pub_share_pre_fee" jdbcType="VARCHAR" property="pubSharePreFee" />
        <result column="pub_share_rate" jdbcType="VARCHAR" property="pubShareRate" />
        <result column="refund_tag" jdbcType="VARCHAR" property="refundTag" />
        <result column="seller_nick" jdbcType="VARCHAR" property="sellerNick" />
        <result column="seller_shop_title" jdbcType="VARCHAR" property="sellerShopTitle" />
        <result column="site_id" jdbcType="VARCHAR" property="siteId" />

        <result column="site_name" jdbcType="VARCHAR" property="siteName" />
        <result column="subsidy_fee" jdbcType="VARCHAR" property="subsidyFee" />
        <result column="subsidy_rate" jdbcType="VARCHAR" property="subsidyRate" />
        <result column="subsidy_type" jdbcType="VARCHAR" property="subsidyType" />
        <result column="tb_deposit_time" jdbcType="VARCHAR" property="tbDepositTime" />
        <result column="tb_paid_time" jdbcType="VARCHAR" property="tbPaidTime" />
        <result column="terminal_type" jdbcType="VARCHAR" property="terminalType" />
        <result column="tk_commission_fee_for_media_platform" jdbcType="VARCHAR" property="tkCommissionFeeForMediaPlatform" />
        <result column="tk_commission_pre_fee_for_media_platform" jdbcType="VARCHAR" property="tkCommissionPreFeeForMediaPlatform" />
        <result column="tk_commission_rate_for_media_platform" jdbcType="VARCHAR" property="tkCommissionRateForMediaPlatform" />
        <result column="tk_create_time" jdbcType="VARCHAR" property="tkCreateTime" />
        <result column="tk_deposit_time" jdbcType="VARCHAR" property="tkDepositTime" />

        <result column="tk_order_role" jdbcType="VARCHAR" property="tkOrderRole" />
        <result column="tk_paid_time" jdbcType="VARCHAR" property="tkPaidTime" />
        <result column="tk_status" jdbcType="VARCHAR" property="tkStatus" />
        <result column="tk_total_rate" jdbcType="VARCHAR" property="tkTotalRate" />
        <result column="total_commission_fee" jdbcType="VARCHAR" property="totalCommissionFee" />
        <result column="total_commission_rate" jdbcType="VARCHAR" property="totalCommissionRate" />
        <result column="trade_id" jdbcType="VARCHAR" property="tradeId" />
        <result column="trade_parent_id" jdbcType="VARCHAR" property="tradeParentId" />

        <result column="order_status" jdbcType="VARCHAR" property="orderStatus" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    </resultMap>


    <select id="findExistGoodsInfoList" resultType="java.lang.String">
           select trade_id from orders_info
    </select>




    <insert id="addGoodsInfo" >
        insert INTO orders_info (
                    adzone_id,
                    adzone_name,
                    alimama_rate,
                    alimama_share_fee,
                    alipay_total_price,
                    click_time,
                    deposit_price,
                    flow_source,
                    income_rate,
                    item_category_name,
                    item_id,
                    item_img,
                    item_link,
                    item_num,
                    item_price,
                    item_title,
                    order_type,
                    pub_id,
                    pub_share_fee,
                    pub_share_pre_fee,
                    pub_share_rate,
                    refund_tag,
                    seller_nick,
                    seller_shop_title,
                    site_id,
                    site_name,
                    subsidy_fee,
                    subsidy_rate,
                    subsidy_type,
                    tb_deposit_time,
                    tb_paid_time,
                    terminal_type,
                    tk_commission_fee_for_media_platform,
                    tk_commission_pre_fee_for_media_platform,
                    tk_commission_rate_for_media_platform,
                    tk_create_time,
                    tk_deposit_time,
                    tk_order_role,
                    tk_paid_time,
                    tk_status,
                    tk_total_rate,
                    total_commission_fee,
                    total_commission_rate,
                    trade_id,
                    trade_parent_id,
                    order_status,
                    order_create_time
                    )VALUES(
                    #{adzone_id},
                    #{adzone_name},
                    #{alimama_rate},
                    #{alimama_share_fee},
                    #{alipay_total_price},
                    #{click_time},
                    #{deposit_price},
                    #{flow_source},
                    #{income_rate},
                    #{item_category_name},
                    #{item_id},
                    #{item_img},
                    #{item_link},
                    #{item_num},
                    #{item_price},
                    #{item_title},
                    #{order_type},
                    #{pub_id},
                    #{pub_share_fee},
                    #{pub_share_pre_fee},
                    #{pub_share_rate},
                    #{refund_tag},
                    #{seller_nick},
                    #{seller_shop_title},
                    #{site_id},
                    #{site_name},
                    #{subsidy_fee},
                    #{subsidy_rate},
                    #{subsidy_type},
                    #{tb_deposit_time},
                    #{tb_paid_time},
                    #{terminal_type},
                    #{tk_commission_fee_for_media_platform},
                    #{tk_commission_pre_fee_for_media_platform},
                    #{tk_commission_rate_for_media_platform},
                    #{tk_create_time},
                    #{tk_deposit_time},
                    #{tk_order_role},
                    #{tk_paid_time},
                    #{tk_status},
                    #{tk_total_rate},
                    #{total_commission_fee},
                    #{total_commission_rate},
                    #{trade_id},
                    #{trade_parent_id},
                    0,
                    NOW()
                    )
    </insert>




    <update id="updateGoodsInfoStatus">
                 update orders_info set
                        adzone_id=#{adzone_id},
                        adzone_name=#{adzone_name},
                        alimama_rate=#{alimama_rate},
                        alimama_share_fee=#{alimama_share_fee},
                        alipay_total_price=#{alipay_total_price},
                        click_time=#{click_time},
                        deposit_price=#{deposit_price},
                        flow_source=#{flow_source},
                        income_rate=#{income_rate},
                        item_category_name=#{item_category_name},
                        item_id=#{item_id},
                        item_img=#{item_img},
                        item_link=#{item_link},
                        item_num=#{item_num},
                        item_price=#{item_price},
                        item_title=#{item_title},
                        order_type=#{order_type},
                        pub_id=#{pub_id},
                        pub_share_fee=#{pub_share_fee},
                        pub_share_pre_fee=#{pub_share_pre_fee},
                        pub_share_rate=#{pub_share_rate},
                        refund_tag=#{refund_tag},
                        seller_nick=#{seller_nick},
                        seller_shop_title=#{seller_shop_title},
                        site_id=#{site_id},
                        site_name=#{site_name},
                        subsidy_fee=#{subsidy_fee},
                        subsidy_rate=#{subsidy_rate},
                        subsidy_type=#{subsidy_type},
                        tb_deposit_time=#{tb_deposit_time},
                        tb_paid_time=#{tb_paid_time},
                        terminal_type=#{terminal_type},
                        tk_commission_fee_for_media_platform=#{tk_commission_fee_for_media_platform},
                        tk_commission_pre_fee_for_media_platform=#{tk_commission_pre_fee_for_media_platform},
                        tk_commission_rate_for_media_platform=#{tk_commission_rate_for_media_platform},
                        tk_create_time=#{tk_create_time},
                        tk_deposit_time=#{tk_deposit_time},
                        tk_order_role=#{tk_order_role},
                        tk_paid_time=#{tk_paid_time},
                        tk_status=#{tk_status},
                        tk_total_rate=#{tk_total_rate},
                        total_commission_fee=#{total_commission_fee},
                        total_commission_rate=#{total_commission_rate},
                        trade_id=#{trade_id},
                        trade_parent_id=#{trade_parent_id},
                        order_update_time=now()
                        where trade_id=#{trade_id}

    </update>


    <update id="BalanceGoodsInfo">
                 update orders_info set
                        order_balance_time=now()
                        where trade_id=#{trade_id}

    </update>


    <select id="oderQueryByParentId" resultType="cn.taobao.entity.order.OrderInfo">
        select * from orders_info where trade_parent_id=#{trade_parent_id}
    </select>


    <select id="validOrderNum" resultType="cn.taobao.entity.order.OrderInfo">
        select * from orders_info where trade_parent_id=#{trade_parent_id} limit 1
    </select>


    <select id="checkFirstOrder" resultType="cn.taobao.entity.order.UserOrder">
        select * from user_order where user_remark_name=#{remarkName} limit 1
    </select>


    <select id="hasBindOrders" resultType="cn.taobao.entity.order.UserOrder">
        select * from user_order
    </select>




    <insert id="bindUserAndOrder">
        insert into user_order(
        user_remark_name,
        user_sex,
        user_signature,
        trade_id,
        trade_parent_id,
        create_time,
        order_status
        )values
        <foreach collection="userOrderList" item="userOrder" index="index" separator=",">
            (
            #{userOrder.user_remark_name},
            #{userOrder.user_sex},
            #{userOrder.user_signature},
            #{userOrder.trade_id},
            #{userOrder.trade_parent_id},
            now(),
            0
            )
        </foreach>
    </insert>


    <select id="selectUserOrder" resultType="cn.taobao.entity.order.UserOrder">
        select * from user_order where user_remark_name=#{remarkName} limit 1
    </select>










</mapper>